@inject NavigationManager Navigation

<MudDrawer @bind-Open="Open"
           Variant="DrawerVariant.Responsive"
           Elevation="3"
           Fixed="true"
           Anchor="Anchor.Left"
           Class="pa-4 glass-drawer">

    <MudText Typo="Typo.h6" Align="Align.Center" Class="mb-2" Color="Color.Primary">
        <MudImage Src="img/icon.png" Height="50" Width="50"></MudImage> ExpForge
    </MudText>

    <MudNavMenu>
        @foreach (var item in MenuItems)
        {
            bool isActive = CurrentPath.Equals(item.Path.TrimStart('/'), StringComparison.OrdinalIgnoreCase);

            <MudButton Variant="Variant.Text"
                       StartIcon="@item.Icon"
                       Class=@($"mb-2 nav-button {(isActive ? "active" : "")}")
                       Style="border-radius:10px; justify-content:flex-start; width:100%;"
                       OnClick="@(() => Navigate(item.Path))">
                @item.Title
            </MudButton>
        }
    </MudNavMenu>
</MudDrawer>

<style>
    .glass-drawer {
        width: 250px !important;
        background-color: rgba(31, 40, 51, 0.8);
        color: #E4E4E4;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }

    .nav-button {
        color: #E4E4E4;
        text-align: center;
        text-transform: none;
        transition: all 0.3s ease;
    }

        .nav-button:hover {
            background-color: rgba(69, 162, 158, 0.2);
        }

        .nav-button.active {
            background-color: rgba(69, 162, 158, 0.4);
            font-weight: bold;
            color: white;
        }
</style>

@code {
    [Parameter] public bool Open { get; set; }
    [Parameter] public EventCallback<bool> OpenChanged { get; set; }

    private string CurrentPath = string.Empty;

    private List<MenuItem> MenuItems = new()
    {
        new MenuItem("ExpForge", "/", Icons.Material.Filled.Home),
        new MenuItem("Getting Started", "/Docs/Getting-Started", Icons.Material.Filled.Person),
        new MenuItem("Explore", "/Docs/Explore", Icons.Material.Filled.AddCircle),
    };

    public record MenuItem(string Title, string Path, string Icon);

    protected override void OnInitialized()
    {
        UpdateCurrentPath();
        Navigation.LocationChanged += (_, __) =>
        {
            UpdateCurrentPath();
            InvokeAsync(StateHasChanged);
        };
    }

    private void Navigate(string path)
    {
        Navigation.NavigateTo(path);
        UpdateCurrentPath();
    }

    private void UpdateCurrentPath()
    {
        CurrentPath = Navigation.ToBaseRelativePath(Navigation.Uri);
    }
}
